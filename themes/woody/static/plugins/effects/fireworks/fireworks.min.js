var options={startingHue:120,clickLimiter:5,timerInterval:20,showTargets:!1,rocketSpeed:speed,rocketAcceleration:1.03,particleFriction:.95,particleGravity:1,particleMinCount:minimum,particleMaxCount:maximum,particleMinRadius:3,particleMaxRadius:5},fireworks=[],particles=[],mouse={down:!1,x:0,y:0},currentHue=options.startingHue,clickLimiterTick=0,timerTick=0,cntRocketsLaunched=0;function random(t,i){return Math.random()*(i-t)+t}function calculateDistance(t,i,e,a){var s=t-e,n=i-a;return Math.sqrt(Math.pow(s,2)+Math.pow(n,2))}window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(callback,1e3/60)};var canvas=document.getElementById("fireworks"),canvasCtx=canvas.getContext("2d"),canvasWidth=window.innerWidth,canvasHeight=window.innerHeight;function Firework(t,i,e,a){for(this.x=this.sx=t,this.y=this.sy=i,this.tx=e,this.ty=a,this.distanceToTarget=calculateDistance(t,i,e,a),this.distanceTraveled=0,this.coordinates=[],this.coordinateCount=3;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=Math.atan2(a-i,e-t),this.speed=options.rocketSpeed,this.acceleration=options.rocketAcceleration,this.brightness=random(50,80),this.hue=currentHue,this.targetRadius=1,this.targetDirection=!1,cntRocketsLaunched++}function Particle(t,i){for(this.x=t,this.y=i,this.coordinates=[],this.coordinateCount=5;this.coordinateCount--;)this.coordinates.push([this.x,this.y]);this.angle=random(0,2*Math.PI),this.speed=random(1,10),this.friction=options.particleFriction,this.gravity=options.particleGravity,this.hue=random(currentHue-20,currentHue+20),this.brightness=random(50,80),this.alpha=1,this.decay=random(.01,.03)}function createParticles(t,i){for(var e=Math.round(random(options.particleMinCount,options.particleMaxCount));e--;)particles.push(new Particle(t,i))}function gameLoop(){requestAnimFrame(gameLoop),currentHue+=.5,canvasCtx.globalCompositeOperation="destination-out",canvasCtx.fillStyle="rgba(0, 0, 0, 0.5)",canvasCtx.fillRect(0,0,canvasWidth,canvasHeight),canvasCtx.globalCompositeOperation="lighter";for(var t=fireworks.length;t--;)fireworks[t].draw(),fireworks[t].update(t);for(t=particles.length;t--;)particles[t].draw(),particles[t].update(t);timerTick>=options.timerInterval?mouse.down||(fireworks.push(new Firework(canvasWidth/2,canvasHeight,random(0,canvasWidth),random(0,canvasHeight/2))),timerTick=0):timerTick++,clickLimiterTick>=options.clickLimiter?mouse.down&&(fireworks.push(new Firework(canvasWidth/2,canvasHeight,mouse.x,mouse.y)),clickLimiterTick=0):clickLimiterTick++}canvas.width=canvasWidth,canvas.height=canvasHeight,Firework.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.targetDirection?this.targetRadius>1?this.targetRadius-=.15:this.targetDirection=!1:this.targetRadius<8?this.targetRadius+=.15:this.targetDirection=!0,this.speed*=this.acceleration;var i=Math.cos(this.angle)*this.speed,e=Math.sin(this.angle)*this.speed;this.distanceTraveled=calculateDistance(this.sx,this.sy,this.x+i,this.y+e),this.distanceTraveled>=this.distanceToTarget?(createParticles(this.tx,this.ty),fireworks.splice(t,1)):(this.x+=i,this.y+=e)},Firework.prototype.draw=function(){var t=this.coordinates[this.coordinates.length-1];canvasCtx.beginPath(),canvasCtx.moveTo(t[0],t[1]),canvasCtx.lineTo(this.x,this.y),canvasCtx.strokeStyle="hsl("+this.hue+",100%,"+this.brightness+"%)",canvasCtx.stroke(),options.showTargets&&(canvasCtx.beginPath(),canvasCtx.arc(this.tx,this.ty,this.targetRadius,0,2*Math.PI),canvasCtx.stroke())},Particle.prototype.update=function(t){this.coordinates.pop(),this.coordinates.unshift([this.x,this.y]),this.speed*=this.friction,this.x+=Math.cos(this.angle)*this.speed,this.y+=Math.sin(this.angle)*this.speed+this.gravity,this.alpha-=this.decay,this.alpha<=this.decay&&particles.splice(t,1)},Particle.prototype.draw=function(){this.coordinates[this.coordinates.length-1];var t=Math.round(random(options.particleMinRadius,options.particleMaxRadius)),i=canvasCtx.createRadialGradient(this.x,this.y,0,this.x,this.y,t);i.addColorStop(0,"white"),i.addColorStop(0,"white"),i.addColorStop(.1,"hsla("+this.hue+",100%,"+this.brightness+"%,"+this.alpha+")"),i.addColorStop(0,"black"),canvasCtx.beginPath(),canvasCtx.fillStyle=i,canvasCtx.arc(this.x,this.y,t,2*Math.PI,!1),canvasCtx.fill()},window.addEventListener("resize",(function(t){canvas.width=canvasWidth=window.innerWidth,canvas.height=canvasHeight=window.innerHeight})),canvas.addEventListener("mousemove",(function(t){t.preventDefault(),mouse.x=t.pageX-canvas.offsetLeft,mouse.y=t.pageY-canvas.offsetTop})),canvas.addEventListener("mousedown",(function(t){t.preventDefault(),mouse.down=!0})),canvas.addEventListener("mouseup",(function(t){t.preventDefault(),mouse.down=!1})),window.onload=gameLoop();