var ww=document.documentElement.clientWidth||document.body.clientWidth,wh=window.innerHeight,ww2=.5*ww,wh2=.5*wh;function Tunnel(){this.init(),this.createMesh(),this.handleEvents(),window.requestAnimationFrame(this.render.bind(this))}Tunnel.prototype.init=function(){this.speed=.02,this.mouse={position:new THREE.Vector2(0,0),target:new THREE.Vector2(0,0)},this.renderer=new THREE.WebGLRenderer({antialias:!0,canvas:document.querySelector(".brick_tunnel")}),this.renderer.setSize(ww,wh),this.renderer.setClearColor(2236962),this.camera=new THREE.PerspectiveCamera(15,ww/wh,.01,1e3),this.camera.position.z=.35,this.scene=new THREE.Scene,this.scene.fog=new THREE.Fog(2236962,.6,2.8)},Tunnel.prototype.createMesh=function(){for(var e=[],t=0;t<5;t+=1)e.push(new THREE.Vector3(0,0,t/4*2.5));e[4].y=-.06,this.curve=new THREE.CatmullRomCurve3(e);var i=new THREE.Geometry;i.vertices=this.curve.getPoints(70),this.splineMesh=new THREE.Line(i,new THREE.LineBasicMaterial),this.tubeMaterial=new THREE.MeshStandardMaterial({side:THREE.BackSide,map:textures.stone.texture,bumpMap:textures.stoneBump.texture,bumpScale:3e-4});var s=new THREE.HemisphereLight(16777147,8943993,.9);this.scene.add(s);var n=new THREE.DirectionalLight(16777215,.8);this.scene.add(n),this.tubeMaterial.map.wrapS=THREE.RepeatWrapping,this.tubeMaterial.map.wrapT=THREE.RepeatWrapping,this.tubeMaterial.map.repeat.set(30,6),this.tubeMaterial.bumpMap.wrapS=THREE.RepeatWrapping,this.tubeMaterial.bumpMap.wrapT=THREE.RepeatWrapping,this.tubeMaterial.bumpMap.repeat.set(30,6),this.tubeGeometry=new THREE.TubeGeometry(this.curve,70,.02,50,!1),this.tubeMesh=new THREE.Mesh(this.tubeGeometry,this.tubeMaterial),this.scene.add(this.tubeMesh),this.tubeGeometry_o=this.tubeGeometry.clone()},Tunnel.prototype.handleEvents=function(){window.addEventListener("resize",this.onResize.bind(this),!1),document.body.addEventListener("mousemove",this.onMouseMove.bind(this),!1)},Tunnel.prototype.onResize=function(){ww=document.documentElement.clientWidth||document.body.clientWidth,wh=window.innerHeight,ww2=.5*ww,wh2=.5*wh,this.camera.aspect=ww/wh,this.camera.updateProjectionMatrix(),this.renderer.setSize(ww,wh)},Tunnel.prototype.onMouseMove=function(e){this.mouse.target.x=(e.clientX-ww2)/ww2,this.mouse.target.y=(wh2-e.clientY)/wh2},Tunnel.prototype.updateCameraPosition=function(){this.mouse.position.x+=(this.mouse.target.x-this.mouse.position.x)/30,this.mouse.position.y+=(this.mouse.target.y-this.mouse.position.y)/30,this.camera.rotation.z=.2*this.mouse.position.x,this.camera.rotation.y=Math.PI-.06*this.mouse.position.x,this.camera.position.x=.015*this.mouse.position.x,this.camera.position.y=.015*-this.mouse.position.y},Tunnel.prototype.updateMaterialOffset=function(){this.tubeMaterial.map.offset.x+=this.speed},Tunnel.prototype.updateCurve=function(){for(var e=0,t=null,i=null,s=0,n=this.tubeGeometry.vertices.length;s<n;s+=1)t=this.tubeGeometry_o.vertices[s],i=this.tubeGeometry.vertices[s],e=Math.floor(s/50),i.x+=(t.x+this.splineMesh.geometry.vertices[e].x-i.x)/10,i.y+=(t.y+this.splineMesh.geometry.vertices[e].y-i.y)/5;this.tubeGeometry.verticesNeedUpdate=!0,this.curve.points[2].x=.1*-this.mouse.position.x,this.curve.points[4].x=.1*-this.mouse.position.x,this.curve.points[2].y=.1*this.mouse.position.y,this.splineMesh.geometry.verticesNeedUpdate=!0,this.splineMesh.geometry.vertices=this.curve.getPoints(70)},Tunnel.prototype.render=function(){this.updateMaterialOffset(),this.updateCameraPosition(),this.updateCurve(),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(this.render.bind(this))};var textures={stone:{url:texture_bg_brick_tunnel},stoneBump:{url:texture_bg_brick_tunnel}},loader=new THREE.TextureLoader;for(var name in loader.crossOrigin="Anonymous",textures)!function(e){loader.load(textures[e].url,(function(t){textures[e].texture=t,checkTextures()}))}(name);var texturesLoaded=0;function checkTextures(){++texturesLoaded===Object.keys(textures).length&&(document.body.classList.remove("loading"),window.tunnel=new Tunnel)}