"use strict";function _inherits(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var CustomPQ=function t(){_classCallCheck(this,t),this.arr=[],this.N=0};CustomPQ.prototype=function(){var t=function(t,i){return t.time>i.time>0},i=function(t,i){var s=this.arr[t];this.arr[t]=this.arr[i],this.arr[i]=s},s=function(s){for(;s>1&&t(this.arr[Math.floor(s/2)],this.arr[s]);)i.call(this,s,Math.floor(s/2)),s=Math.floor(s/2)},o=function(s){for(;2*s<=this.N;){var o=2*s;if(o<this.N&&t(this.arr[o],this.arr[o+1])&&++o,!t(this.arr[s],this.arr[o]))break;i.call(this,s,o),s=o}};return{insert:function(t){this.arr[++this.N]=t,s.call(this,this.N)},getMin:function(){i.call(this,1,this.N);var t=this.arr[this.N--];return o.call(this,1),this.arr[this.N+1]=null,t},isEmpty:function(){return 0===this.N}}}();var Ball=function(){function t(){var i=arguments.length<=4||void 0===arguments[4]?8:arguments[4];_classCallCheck(this,t),this.x=Math.random()*window.innerWidth,this.y=Math.random()*window.innerHeight,this.velocityX=5*Math.random(),this.velocityY=5*Math.random(),this.radius=i,this.mass=.5,this.count=0}return t.prototype.getCount=function(){return this.count},t.prototype.draw=function(t){t.beginPath(),t.arc(this.x,this.y,this.radius,0,360),t.fill()},t.prototype.move=function(t){this.x+=this.velocityX*t,this.y+=this.velocityY*t,Math.floor(this.x),Math.floor(this.y)},t.prototype.timeToHit=function(t){if(this===t)return 1/0;var i=t.x-this.x,s=t.y-this.y,o=t.velocityX-this.velocityX,n=t.velocityY-this.velocityY,e=i*o+s*n;if(e>0)return 1/0;var r=o*o+n*n,l=i*i+s*s,h=this.radius+t.radius,a=e*e-r*(l-h*h);return a<0?1/0:-(e+Math.sqrt(a))/r},t.prototype.timeToHitVerticallWall=function(){return this.velocityX>0?(window.innerWidth-this.x-this.radius)/this.velocityX:this.velocityX<0?(this.radius-this.x)/this.velocityX:1/0},t.prototype.timeToHitHorizontalWall=function(){return this.velocityY>0?(window.innerHeight-this.y-this.radius)/this.velocityY:this.velocityY<0?(this.radius-this.y)/this.velocityY:1/0},t.prototype.bounceOff=function(t){var i=t.x-this.x,s=t.y-this.y,o=i*(t.velocityX-this.velocityX)+s*(t.velocityY-this.velocityY),n=this.radius+t.radius,e=2*this.mass*t.mass*o/((this.mass+t.mass)*n),r=e*i/n,l=e*s/n;this.velocityX+=r/this.mass,this.velocityY+=l/this.mass,t.velocityX-=r/t.mass,t.velocityY-=l/t.mass,++this.count,++t.count},t.prototype.bounceOffVerticalWall=function(){this.velocityX=-this.velocityX,++this.count},t.prototype.bounceOffHorizontalWall=function(){this.velocityY=-this.velocityY,++this.count},t}(),BigBall=function(t){function i(){_classCallCheck(this,i),t.call(this),this.radius=24,this.mass=3}return _inherits(i,t),i}(Ball),Event=function(){function t(i,s,o){_classCallCheck(this,t),this.time=i,this.a=s,this.b=o,this.countA=null!=s?s.getCount():-1,this.countB=null!=o?o.getCount():-1}return t.prototype.isValid=function(){return(null==this.a||this.a.getCount()==this.countA)&&(null==this.b||this.b.getCount()==this.countB)},t.prototype.getA=function(){return this.a},t.prototype.getB=function(){return this.b},t.prototype.getTime=function(){return this.time},t}(),CollisionSystem=function(){function t(){_classCallCheck(this,t),this.c=document.getElementById("bubble"),this.ctx=this.c.getContext("2d"),this.balls=[],this.t=0,this.hz=1,this.pq=new CustomPQ,this.numBalls=quantity,window.addEventListener("resize",this.windowResizeHandler.bind(this),!1),this.windowResizeHandler()}return t.prototype.windowResizeHandler=function(){this.SCREEN_WIDTH=window.innerWidth,this.SCREEN_HEIGHT=window.innerHeight,this.c.width=this.SCREEN_WIDTH,this.c.height=this.SCREEN_HEIGHT;var t=this.ctx.createRadialGradient(0,0,1.3*this.SCREEN_WIDTH,0,0,0);t.addColorStop(0,color1),t.addColorStop(.3,color2),t.addColorStop(.6,color3),t.addColorStop(.8,color4),t.addColorStop(1,color5),this.ctx.fillStyle=t},t.prototype.redraw=function(){var t=this;this.ctx.clearRect(0,0,this.SCREEN_WIDTH,this.SCREEN_HEIGHT),this.balls.forEach((function(i){i.draw(t.ctx)})),this.pq.insert(new Event(this.t+1/this.hz,null,null))},t.prototype.predict=function(t){var i=this;if(null!=t){this.balls.forEach((function(s){var o=t.timeToHit(s);o!==1/0&&i.pq.insert(new Event(i.t+o,t,s))}));var s=t.timeToHitVerticallWall(),o=t.timeToHitHorizontalWall();s!==1/0&&this.pq.insert(new Event(this.t+s,t,null)),o!==1/0&&this.pq.insert(new Event(this.t+o,null,t))}},t.prototype.simulate=function(){for(var t=this,i=0;i<this.balls.length;++i)this.predict(this.balls[i]);this.pq.insert(new Event(0,null,null)),window.requestAnimationFrame((function i(){var s=t.pq.getMin();if(s.isValid()){var o=s.getA(),n=s.getB();t.balls.forEach((function(i){i.move(s.getTime()-t.t)})),t.t=s.getTime(),null!=o&&null!=n?o.bounceOff(n):null!=o&&null==n?o.bounceOffVerticalWall():null==o&&null!=n?n.bounceOffHorizontalWall():null==o&&null==n&&t.redraw(),t.predict(o),t.predict(n)}window.requestAnimationFrame(i)}))},t.prototype.go=function(){for(var t=0;t<this.numBalls;++t)this.balls[t]=new Ball;this.balls[this.balls.length]=new BigBall,this.simulate()},t}(),cs=new CollisionSystem;cs.go();